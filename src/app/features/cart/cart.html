<div class="cart-page">
  <!-- Notification Toast -->
  @if (notification) {
    <div class="toast" [class.success]="notification.type === 'success'" [class.error]="notification.type === 'error'">
      @if (notification.type === 'success') {
        <i class="fa-solid fa-check-circle"></i>
      } @else {
        <i class="fa-solid fa-times-circle"></i>
      }
      <span>{{ notification.message }}</span>
    </div>
  }

  <div class="cart-container">
    <!-- Header -->
    <div class="cart-header">
      <h1>Panier</h1>
      <p class="cart-summary">{{ itemCount }} article{{ itemCount > 1 ? 's' : '' }}</p>
    </div>

    @if (cartItems.length === 0) {
      <!-- Empty State -->
      <div class="empty-cart">
        <div class="empty-icon">
          <i class="fa-solid fa-bag-shopping"></i>
        </div>
        <h2>Votre panier est vide</h2>
        <p>Découvrez nos produits et ajoutez vos favoris.</p>
        <a routerLink="/catalog" class="btn-primary">
          Voir le catalogue
        </a>
      </div>
    } @else {
      <!-- Cart Content -->
      <div class="cart-content">
        <!-- Items List -->
        <div class="cart-items">
          @for (item of cartItems; track item.product.id) {
            <div class="cart-item">
              <div class="item-image">
                @if (item.product.imageUrl) {
                  <img [src]="item.product.imageUrl" [alt]="item.product.name">
                } @else {
                  <div class="placeholder-image">
                    <i class="fa-solid fa-image"></i>
                  </div>
                }
              </div>
              
              <div class="item-details">
                <h3 class="item-name">{{ item.product.name }}</h3>
                <p class="item-description">{{ item.product.description }}</p>
                <p class="item-stock" [class.low-stock]="item.product.stock <= 5">
                  @if (item.product.stock <= 5) {
                    <i class="fa-solid fa-circle-exclamation"></i>
                    Plus que {{ item.product.stock }} en stock
                  } @else {
                    En stock
                  }
                </p>
              </div>

              <div class="item-quantity">
                <button 
                  class="qty-btn" 
                  (click)="updateQuantity(item.product.id!, -1)"
                  [disabled]="item.quantity <= 1">
                  <i class="fa-solid fa-minus"></i>
                </button>
                <span class="qty-value">{{ item.quantity }}</span>
                <button 
                  class="qty-btn" 
                  (click)="updateQuantity(item.product.id!, 1)"
                  [disabled]="item.quantity >= item.product.stock">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>

              <div class="item-price">
                <span class="price">{{ (item.product.price * item.quantity).toFixed(2) }} €</span>
                @if (item.quantity > 1) {
                  <span class="unit-price">{{ item.product.price.toFixed(2) }} € / unité</span>
                }
              </div>

              <button class="remove-btn" (click)="removeItem(item.product.id!)">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
          }
        </div>

        <!-- Summary -->
        <div class="cart-summary-box">
          <div class="summary-content">
            <h3>Récapitulatif</h3>
            
            <div class="summary-row">
              <span>Sous-total</span>
              <span>{{ total.toFixed(2) }} €</span>
            </div>
            
            <div class="summary-row">
              <span>Livraison</span>
              <span class="free">Gratuite</span>
            </div>
            
            <div class="summary-divider"></div>
            
            <div class="summary-row total">
              <span>Total</span>
              <span>{{ total.toFixed(2) }} €</span>
            </div>

            <button class="btn-checkout" (click)="checkout()" [disabled]="isCheckingOut">
              @if (isCheckingOut) {
                <i class="fa-solid fa-spinner fa-spin"></i>
                Commande en cours...
              } @else {
                <i class="fa-solid fa-lock"></i>
                Passer la commande
              }
            </button>

            <button class="btn-clear" (click)="clearCart()" [disabled]="isCheckingOut">
              Vider le panier
            </button>

            <div class="security-note">
              <i class="fa-solid fa-shield-halved"></i>
              <span>Paiement sécurisé</span>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
